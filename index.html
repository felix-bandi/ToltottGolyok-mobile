<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Töltött golyók – mobil</title>
  <style>
    html,body{height:100%;margin:0}
    body{background:#101012;overflow:hidden;touch-action:none}
    #main{position:fixed;inset:0;width:100%;height:100%}
    canvas{display:block;width:100%;height:100%}
    #hud{position:fixed;top:8px;left:8px;z-index:9999;color:#ddd;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px;font:12px/1.3 system-ui,Segoe UI,Roboto,Arial,sans-serif;pointer-events:none;user-select:none}
    #controls{position:fixed;left:0;right:0;z-index:10000;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);padding:12px 14px;display:flex;flex-direction:column;gap:12px;align-items:stretch;font:12px system-ui;color:#eee;box-sizing:border-box}
    #controls label{display:flex;flex-direction:column;gap:6px;width:100%;flex:0 0 auto;min-width:0}
    #controls input[type=range]{width:92%;margin:0 4%;box-sizing:border-box}
    /* Mobil hosszú nyomás / szöveg kijelölés tiltása a csúszkáknál */
    html,body,#controls,#controls label,#controls input[type=range]{
      -webkit-user-select:none;user-select:none;-webkit-touch-callout:none;
    }
  </style>

  <!-- vendor a webgyökér testvérmappájában -->
  <script type="importmap">
  {
    "imports": {
      "three": "/vendor/three.js-r179/build/three.module.js"
    }
  }
  </script>
</head>
<body>
  <div id="main"></div>
  <div id="hud">FPS: <b id="fps">–</b>&nbsp;&nbsp;Golyók: <b id="balls">–</b></div>
  <div id="controls">
    <label>egér Z
      <input id="slider-eger-z" type="range" min="-1000" max="1000" step="1" value="0" />
    </label>
    <label>Központ töltés
      <input id="slider-kozpont" type="range" min="0" max="3000" step="10" />
    </label>
    <label>Egér töltés
      <input id="slider-eger-toltes" type="range" min="0" max="3000" step="10" />
    </label>
    <label>Rugó állandó D
      <input id="slider-rugo" type="range" min="0" max="0.05" step="0.0005" />
    </label>
    <label>Golyók száma
      <input id="slider-golyok" type="range" min="1" max="500" step="1" />
    </label>
  </div>

  <!-- az egész app külön fájlba költözött -->
  <script type="module" src="./main.js"></script>
  <script type="module">
    import { allapot, state } from './core/state.js';
    import { e_world, kozpont } from './golyo.js';
    const sliderZ = document.getElementById('slider-eger-z');
    const sliderK = document.getElementById('slider-kozpont');
    const sliderE = document.getElementById('slider-eger-toltes');
    const sliderR = document.getElementById('slider-rugo');
    const sliderN = document.getElementById('slider-golyok');
    // Inicializálás jelenlegi állapottal
    sliderZ.value = allapot.eger_z;
    sliderK.value = allapot.kozpont;
    sliderE.value = allapot.eger;
    sliderR.value = allapot.D;
    sliderN.value = allapot.N;
    function applyZ(v){ allapot.eger_z = +v; if (e_world) e_world.z = allapot.eger_z; }
    function applyK(v){ allapot.kozpont = +v; if (kozpont) kozpont.toltes = allapot.kozpont; }
    function applyE(v){ allapot.eger = +v; if (e_world) e_world.toltes = allapot.eger; }
    function applyR(v){ allapot.D = +v; }
    function applyN(v){ allapot.N = +v; }
    sliderZ.addEventListener('input', e=>applyZ(e.target.value));
    sliderK.addEventListener('input', e=>applyK(e.target.value));
    sliderE.addEventListener('input', e=>applyE(e.target.value));
    sliderR.addEventListener('input', e=>applyR(e.target.value));
    sliderN.addEventListener('input', e=>applyN(e.target.value));
    applyZ(sliderZ.value); applyK(sliderK.value); applyE(sliderE.value); applyR(sliderR.value); applyN(sliderN.value);
    function positionControls(){ const vp = state.viewport; const el = document.getElementById('controls'); if(!el) return; if(vp){ el.style.top = vp.h + 'px'; } }
    window.addEventListener('resize', positionControls);
    setInterval(positionControls, 250);
    const controlsEl = document.getElementById('controls');
    if (controlsEl) {
      controlsEl.addEventListener('contextmenu', e=>{ e.preventDefault(); }, {passive:false});
      // Android néha hosszú nyomás után még select start: tiltjuk
      ['selectstart','dragstart'].forEach(ev=>controlsEl.addEventListener(ev,e=>e.preventDefault(),{passive:false}));
    }
  </script>
</body>
</html>
